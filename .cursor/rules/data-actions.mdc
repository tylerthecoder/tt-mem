---
description:
globs:
alwaysApply: true
---
# Data Fetching & Mutations (Server Actions)

Server-side logic, including database interactions (fetching, creating, updating, deleting data), is implemented using Next.js Server Actions.

- **Location:** Actions are defined in files within `[app/actions/](mdc:app/actions)`, typically marked with `'use server';`.
    - Example: `[app/actions/decks.ts](mdc:app/actions/decks.ts)`, `[app/actions/cards.ts](mdc:app/actions/cards.ts)`.
- **Database Interaction:** Actions use the MongoDB client configured in `[app/lib/db.ts](mdc:app/lib/db.ts)` to interact with collections (e.g., `decks`, `cards`, `review_events`).
- **Data Mapping:** MongoDB documents often use `ObjectId` for `_id`. The `mapMongoId` helper in `[app/lib/utils.ts](mdc:app/lib/utils.ts)` is used to convert `_id` to a string `id`. Specific mapping functions (e.g., `mapCardDocument`) may exist within action files.
- **Client Usage:** React Query hooks in `[app/hooks/queryHooks.ts](mdc:app/hooks/queryHooks.ts)` call these server actions to fetch data or perform mutations.
- **Authentication:** Actions typically verify user authentication using the `verifyAuthToken` helper from `[app/lib/auth.ts](mdc:app/lib/auth.ts)` before performing protected operations.
